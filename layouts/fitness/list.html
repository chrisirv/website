{{- define "main" -}}

<header class="page-header">
    <h1>{{ .Title }}</h1>
</header>

<div class="post-content">
    {{- .Content -}}

    {{- if .Site.Data.strava_stats -}}
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 2.5rem; margin-bottom: 2.5rem;">
        
        {{- with .Site.Data.strava_stats.ytd_run_totals -}}
        <div style="background: var(--tertiary); padding: 20px; border-radius: 8px; border: 1px solid var(--border);">
            <div style="font-size: 0.75rem; opacity: 0.7; text-transform: uppercase; letter-spacing: 0.05em;">üèÉ YTD Run</div>
            <div style="font-size: 1.5rem; font-weight: bold; margin-top: 5px;">{{ div .distance 1609.34 | printf "%.1f" }} mi</div>
        </div>
        {{- end -}}

        {{- with .Site.Data.strava_stats.ytd_ride_totals -}}
        <div style="background: var(--tertiary); padding: 20px; border-radius: 8px; border: 1px solid var(--border);">
            <div style="font-size: 0.75rem; opacity: 0.7; text-transform: uppercase; letter-spacing: 0.05em;">üö≤ YTD Ride</div>
            <div style="font-size: 1.5rem; font-weight: bold; margin-top: 5px;">{{ div .distance 1609.34 | printf "%.1f" }} mi</div>
        </div>
        {{- end -}}

    </div>
    {{- end -}}

    {{- if .Site.Data.strava -}}
        {{- $latest := index .Site.Data.strava 0 -}}
        {{- if and $latest.start_latlng (ne (len $latest.start_latlng) 0) -}}
    
        <h3 style="margin-bottom: 1rem;">üìç Last Starting Location</h3>
        <div id="map" style="height: 300px; border-radius: 12px; margin-bottom: 2.5rem; border: 1px solid var(--border); z-index: 1;"></div>

        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Pulling coordinates from Hugo data
                const lat = {{ index $latest.start_latlng 0 }};
                const lng = {{ index $latest.start_latlng 1 }};
                const activityName = {{ $latest.name }};

                // Initialize map
                const map = L.map('map').setView([lat, lng], 7);

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);

                // Add marker
                L.marker([lat, lng]).addTo(map)
                    .bindPopup(`<b>Last Activity:</b><br>${activityName}`)
                    .openPopup();
            });
        </script>
        {{- end -}}
    {{- end -}}

    {{- if .Site.Data.strava -}}
    <div class="recent-activities">
        <h3 style="margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 10px;">Recent Activities</h3>
        
        {{- range first 10 .Site.Data.strava -}}
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border);">
            
            <div style="flex-grow: 1;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2rem;">
                        {{- if eq .type "Run" -}}üèÉ
                        {{- else if eq .type "Ride" -}}üö≤
                        {{- else if eq .type "Walk" -}}ü•æ
                        {{- else -}}üèãÔ∏è
                        {{- end -}}
                    </span>
                    <strong style="font-size: 1.1rem;">{{ .name | default "Activity" }}</strong>
                </div>
            
                <div style="font-size: 0.85rem; opacity: 0.7; margin-top: 4px;">
                    {{- if .start_date_local -}}
                        {{- time.Format "Mon, Jan 02" .start_date_local -}}
                    {{- end -}}
                    ‚Ä¢ {{ .type }}
                    {{- if .moving_time -}}
                        ‚Ä¢ {{ $total_mins := div .moving_time 60.0 }}
                        {{- if ge $total_mins 60 -}}
                            {{- $hrs := math.Floor (div $total_mins 60) -}}
                            {{- $mins := mod (math.Round $total_mins) 60 -}}
                            {{ $hrs }}h {{ $mins }}m
                        {{- else -}}
                            {{ math.Round $total_mins }}m
                        {{- end -}}
                    {{- end -}}
                </div>

            </div>

            <div style="text-align: right;">
                <div style="font-family: monospace; font-weight: bold; font-size: 1.1rem; color: var(--secondary);">
                    {{- if .distance -}}
                        {{ div .distance 1609.34 | printf "%.2f" }} mi
                    {{- else -}}
                        --
                    {{- end -}}
                </div>
                {{- if .total_elevation_gain -}}
                <div style="font-size: 0.75rem; opacity: 0.6;">
                    ‚ñ≤ {{ mul .total_elevation_gain 3.28084 | printf "%.0f" }} ft
                </div>
                {{- end -}}
            </div>
        </div>
        {{- end -}}
    </div>
    {{- end -}}

</div>

<section class="ai-prompt-share" style="background: var(--tertiary); padding: 25px; border-radius: 12px; border: 1px dashed var(--border);">
    <h3 style="margin-top: 0;">Want this dashboard on your site?</h3>
    <p style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 15px;">Copy the prompt below and paste it into Gemini or ChatGPT to recreate this setup.</p>
    
    <div style="background: var(--code-bg); padding: 15px; border-radius: 8px; border: 1px solid var(--border); overflow-x: auto;">
        <pre style="margin: 0; white-space: nowrap; font-size: 0.85rem; color: var(--primary);"><code id="ai-prompt">I want to build an automated Strava dashboard for Hugo with a Python script, GitHub Actions, and a Leaflet.js map (zoom 9) showing my last location. Provide the script, workflow YAML, and HTML/JS with metric-to-imperial conversions.</code></pre>
    </div>
    
    <p style="font-size: 0.75rem; margin-top: 10px; opacity: 0.6;">
        üí° <strong>Tip:</strong> Ensure GitHub Actions has "Read and write permissions" under <em>Settings > Actions > General</em>.
    </p>
</section>

{{- end -}}